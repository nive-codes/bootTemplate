<!--ComFileUpload.html (DROPZONE 활용 파일 업로드)-->

<html xmlns:th="http://www.thymeleaf.org">


<!--<body>-->
<div th:fragment="fileupload(fileDiv, fileId, fileType, fileSize,fileCnt, filePath)">
    <div class="dropzone" th:id="${fileDiv}"></div>

    <!-- JS 파일 로드 -->
    <script src="/js/ComFileUploadInit.js"></script>

    <script type="text/javascript">
        Dropzone.autoDiscover = false;
        <!-- 파일 업로드를 위한 Dropzone 초기화 -->
        document.addEventListener("DOMContentLoaded", function () {
            initDropzone('[[${fileDiv}]]', '[[${fileId}]]', '[[${fileType}]]', '[[${fileSize}]]', '[[${fileCnt}]]','[[${filePath}]]');
        });
    </script>

<!--    <script type="text/javascript">-->
<!--        document.addEventListener("DOMContentLoaded", function () {-->
<!--                var upldFileDiv = '[[${fileDiv}]]';-->
<!--                var upldFileId = '[[${fileId}]]';-->
<!--                var upldFileType = '[[${fileType}]]';-->
<!--                var upldFileSize = '[[${fileSize}]]';-->
<!--                var upldFilePath = '[[${filePath}]]';-->

<!--                new Dropzone("#"+upldFileDiv, {-->
<!--                    url: "/api/tempFiles/upload",-->
<!--                    maxFilesize: upldFileSize,-->
<!--                    acceptedFiles: upldFileType === 'IMAGE' ? "image/*" : "*",-->
<!--                    method: 'post',-->
<!--                    paramName: 'files',-->
<!--                    addRemoveLinks: true,-->
<!--                    dictRemoveFile: '삭제',-->
<!--                    params: function() {-->
<!--                        return {-->
<!--                            fileType: upldFileType,-->
<!--                            fileSize: upldFileSize,-->
<!--                            filePath: upldFilePath-->
<!--                        };-->
<!--                    },-->
<!--                    init: function() {-->
<!--                        this.on("success", function(file, response) {-->
<!--                            console.log("파일 업로드 성공:", response);-->
<!--                            if (response.code === 'SUCCESS') {-->
<!--                                document.getElementById(upldFileId).value = response.data.fileId;-->
<!--                                file.fileId = response.data.fileId;-->
<!--                                file.fileSeq = response.data.fileSeq;-->
<!--                                file.fileOrd = response.data.fileOrd;-->
<!--                            } else {-->
<!--                                alert(response.message);-->
<!--                            }-->
<!--                        });-->

<!--                        this.on("error", function(file, errorMessage) {-->
<!--                            console.error("파일 업로드 실패:", errorMessage);-->
<!--                        });-->

<!--                        this.on("removedfile", function(file) {-->
<!--                            if (file.fileSeq) {-->
<!--                                console.log("파일 삭제 시 fileSeq:", file.fileSeq);-->
<!--                                fetch('/api/tempFiles/upload/' + file.fileId, {-->
<!--                                    method: 'DELETE',-->
<!--                                    headers: {-->
<!--                                        'Content-Type': 'application/json'-->
<!--                                    },-->
<!--                                    body: JSON.stringify({ fileSeq: file.fileSeq, fileId: document.getElementById(upldFileId).value })  /*Path와 hidden의 값으로 서버에서 비교처리*/-->
<!--                                }).then(response => {-->
<!--                                    if (!response.ok) {-->
<!--                                        throw new Error('파일 삭제 실패');-->
<!--                                    }-->
<!--                                    return response.json();-->
<!--                                }).then(data => {-->
<!--                                    console.log("파일 삭제 완료:", data);-->
<!--                                }).catch(error => {-->
<!--                                    console.error("파일 삭제 실패:", error);-->
<!--                                    alert("파일 삭제에 실패했습니다. 다시 시도해주세요.");-->
<!--                                });-->
<!--                            }-->
<!--                        });-->
<!--                    }-->
<!--                });-->
<!--        });-->
<!--    </script>-->
</div>

</html>